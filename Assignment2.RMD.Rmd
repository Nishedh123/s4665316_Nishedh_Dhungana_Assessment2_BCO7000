---
title: "Assignment 2"
author: "Nishedh_s4665316"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## *Nishedh_Dhungana*
## **s4665316**



```{r}
library(tidyverse)
library(knitr)
library(randomForest)
library(widyr)
library(dplyr)
library(skimr)
```



```{r}
happymeals<-read_csv ("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2018/2018-11-20/thanksgiving_meals.csv")

```

#Question_1 Display the first 10 rows of the dataset using `kable()` function 

```{r}
kable(happymeals[1:10, ])
```



#Question_2 Using `skim()` display the summary of variables
```{r}
skim(happymeals)


#Here, it can be said that in order to predict the family income based on their menu, input variable such as, 'us_region', 'gender', 'community_type', 'age' etc can be used. However, the skim() function indicates that all the variables are of character type. It means, none of the variables are in right format to predict the family income. Therefore, all the variables needs to be recoded into factor variable to build prediction model.


#Here, it can be said that in order to predict the US_region based on their menu, variable such as, 'cranberry', 'stuffing', 'gravy' 'dessert1', 'side1', 'pie1', etc can be used. However, the skim() function indicates that all the variables are of character type. It means, none of the variables are in right format to predict the community type or US_region. Therefore, all the variables needs to be recoded into factor variable to build prediction model.

#Here, it can be said that in order to predict the community_type based on their menu, variable such as, 'friendsgiving', 'work_black_friday', 'watch_program' 'hometown_friends', etc can be used. However, the skim() function indicates that all the variables are of character type. It means, none of the variables are in right format to predict the community type or US_region. Therefore, all the variables needs to be recoded into factor variable to build prediction model.


```
#Question_3 Use `fct_reorder` and `parse_number` functions to create a factor variable `family_income`
```{r}
happymeals<- happymeals%>%
  mutate(family_income = fct_reorder(family_income, parse_number(family_income)))

skim(happymeals)

#By using this function, we have converted family_income from character variable to factor variable.
```


#Question_4 What is the number of people who celebrate?
```{r}
happymeals%>%
  filter(celebrate == "Yes")

#The are 980 people who celebrate out of 1058.
  
```

#Question_5 What are categories and insights for each main dish served and the method it is prepared?
```{r}
dish_prep <- happymeals%>%
  select(main_dish, main_prep)


#It shows the categories for main_dish and main_prep variables with respective to each other.
```


#Question_6 Create 3 different data viz showing insights for main dish served and the method. Provide your own legend and use themes.
```{r}
object <- table(dish_prep$main_dish, dish_prep$main_prep)
tb.prop <- prop.table(object, 1)
tb.df <- as.data.frame(tb.prop)
names(tb.df) <- c("main_dish", "main_prep", "Frequency")
ggplot(tb.df, aes(x=main_dish, y=Frequency, fill=main_prep)) + 
  geom_col()+
  coord_flip()

#The first graph is a stacked column chart. 
#Stacked column graphs function admirably when the focal point of the outline is to analyze the aggregates and one piece of the sums. 
#It's difficult for reader to think about sections that don't begin at a similar gauge. 
#In the event that the all out of your parts isn't significant, a line graph is a superior decision. 
#It tends to be speedier understandable by the reader.

ggplot(tb.df, aes(x=main_dish, y=Frequency, fill=main_prep)) +
  geom_col(position="dodge")+
  coord_flip()

#The second graph is group column chart.
#The grouped column chart presents quantitative values for categories and additional categorical dimensions. 
#This is ideal as the analyst want to give a quick overview of something as the analyst would do with a bar chart or column chart but add more information with the help of additional columns.

ggplot(tb.df, aes(x=main_dish, y=Frequency, color=main_prep, group=main_prep)) +
  geom_line()+
  coord_flip()

#It is group line chart and it is basically used to display the trend over a category or specific time frame.
```

#Question_7 How many use cranberry sauce? How many use gravy?
```{r}
happymeals%>%
filter(cranberry=="Homemade"|cranberry== "Canned")%>%
  count(cranberry)

# So, in total there are 803 people who use cranberry sauce out of 1058 people.


happymeals %>%
  filter( gravy =="Yes")%>%
  count(gravy)

# So, in total there are 892 people who use gravy out of 1058 people.

```

#Question_8-9 What is the distribution of those who celebrate across income ranges. Create a data viz. Write 2-3 sentences with your explanation of each insight.
```{r}
happymeals %>% 
  count(family_income, celebrate)%>%
  kable()
  
  ggplot(happymeals, aes(x = family_income, y = celebrate, fill = celebrate, label = family_income)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  theme_linedraw()


#This particular graph is showing the distribution of those who celebrate across income ranges.
#From this graph it is noted that the income group 175000-199999 has the lowest number people who celebrates.
#While, the study has shown that 25000-49999 has the highest number of people who celebrates.

```
#Question_10 Use the following code to create a new data set
```{r}
new_meals <- happymeals%>% select(id, starts_with("side"),
                     starts_with("pie"),
                     starts_with("dessert")) %>%
  select(-side15, -pie13, -dessert12) %>%
  gather(type, value, -id) %>%
  filter(!is.na(value),
         !value %in% c("None", "Other (please specify)")) %>%
  mutate(type = str_remove(type, "\\d+"))


#The new data set i.e. new_meals have selected side, pie and dessert and and removed the variables such as side 15, pie 13 and dessert 12.
#It has also detected Other (please specify) and removed from the table for better data presentation.
#This data set only shows 8145 obs. of 3 variables now and they are ID, Type and Value and has been arranged according to side, pie and dessert respectively.

```


#Question_11 Intall package `widyr` and use `pairwise_cor()`. Write 2-3 sentences with your explanation of what it does. 
```{r}
#It is used to find the correlations of pairs of items in a column, based on a "feature" column that links them together.
#It is useful for several operations such as co-occurrence counts, correlations, or clustering that are mathematically convenient on wide matrices.

```

#Question_12 Use this code for new dataset
```{r}
new_meals%>%
  pairwise_cor(value, id, sort= TRUE)

#On the result, it shows the correlation between all the side, pie and dessert that is under value heading on new_meals.
```

#Question_13 Use `lm()` or randomForest() function to build a model that predict a family income based on data in the dataset.Compare 3 models using different set of input variables. Use different number of variables.
```{r}
rf <- randomForest(family_income ~ us_region + gender + community_type + age ,data = happymeals, na.action = na.omit)

print(rf)

rf1 <- randomForest(family_income ~ us_region + gender + community_type + age + side1 + side2 ,data = happymeals, na.action = na.omit)

print (rf1)


rf2 <- randomForest(family_income ~ friendsgiving + black_friday + travel ,data = happymeals, na.action = na.omit)

print (rf2)

#The first, second and third model have estimate of error rate of 85.07%, 96.43% and 82.89% respectively, and out of 3 models compared model 3 has less error rate which is better than the other models.
# But, since the error rate of all 3 models are very high, these model will not be used for predicting the outcome.
```







